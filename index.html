<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ€ç»´æ¼”æ­¦åœº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .card-active { border: 2px solid #2563eb; }
    </style>
</head>
<body class="bg-[#f8fafc] text-[#1e293b] leading-relaxed">
    <nav class="sticky top-0 z-50 glass border-b border-slate-200 px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-black italic tracking-tighter text-blue-600">MIND LAB.</h1>
        <div id="cur-date" class="text-[10px] font-mono bg-slate-100 px-2 py-1 rounded text-slate-500 uppercase"></div>
    </nav>

    <main class="max-w-lg mx-auto p-6 space-y-6">
        <section>
            <button onclick="syncData()" class="group relative w-full overflow-hidden bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-xl transition-all active:scale-[0.98]">
                <div class="relative z-10 flex items-center justify-center gap-2">
                    <span id="sync-icon">ğŸ”„</span>
                    <span id="sync-text">ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜</span>
                </div>
                <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 opacity-0 group-active:opacity-100 transition-opacity"></div>
            </button>
            <p class="text-[10px] text-center text-slate-400 mt-3 uppercase tracking-widest font-bold">è¯·ç¡®ä¿å·²è¿è¡Œå¿«æ·æŒ‡ä»¤å¹¶å¤åˆ¶å†…å®¹</p>
        </section>

        <section id="main-card" class="bg-white rounded-[2rem] p-8 shadow-sm border border-slate-200/60 relative overflow-hidden">
            <div id="tag" class="inline-block px-3 py-1 bg-blue-50 text-blue-600 text-[10px] font-black rounded-full mb-4 uppercase tracking-tighter">
                Waiting...
            </div>
            <h2 id="title" class="text-2xl font-black text-slate-800 mb-4 leading-tight">å‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„æ·±åº¦æ€è€ƒäº†å—ï¼Ÿ</h2>
            <p id="desc" class="text-slate-500 text-sm mb-8 leading-relaxed italic border-l-2 border-slate-100 pl-4"></p>
            
            <div class="relative">
                <textarea id="thought-input" oninput="saveThought()" class="w-full bg-slate-50 p-5 rounded-2xl text-base h-44 outline-none focus:ring-2 focus:ring-blue-100 transition-all border border-transparent focus:border-blue-200" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„é€»è¾‘æ‹†è§£ã€åˆ©ç›Šåšå¼ˆåˆ†æ..."></textarea>
                <div class="absolute bottom-4 right-4 text-[10px] text-slate-300 font-mono" id="char-count">0 chars</div>
            </div>
        </section>

        <section id="expert-card" class="hidden transform transition-all duration-700">
            <div class="bg-amber-50 rounded-[2rem] p-8 border border-amber-100/50 relative">
                <div class="absolute -top-3 left-8 px-4 py-1 bg-amber-200 text-amber-900 text-[10px] font-black rounded-full uppercase">
                    æ˜¨æ—¥ä¸“å®¶å¯¹å†²è§†è§’
                </div>
                <p id="expert-text" class="text-amber-900/80 text-[15px] leading-relaxed font-medium"></p>
            </div>
        </section>

        <div class="flex gap-3">
            <button onclick="copyMyThought()" class="flex-1 bg-white border border-slate-200 py-3 rounded-xl text-xs font-bold text-slate-600 active:bg-slate-50">å¤åˆ¶æˆ‘çš„æ€è€ƒ</button>
            <button onclick="clearAll()" class="px-4 py-3 rounded-xl text-xs font-bold text-red-400 active:bg-red-50">é‡ç½®</button>
        </div>
    </main>

    <script>
        // åœ¨é¡µé¢åŠ è½½æ—¶ï¼Œè‡ªåŠ¨æ£€æŸ¥ URL ä¸­æ˜¯å¦å¸¦æœ‰ data å‚æ•°
window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    const encodedData = urlParams.get('data');

    if (encodedData) {
        try {
            // è§£ç å¹¶è§£ææ•°æ®
            let text = decodeURIComponent(encodedData);
            // å¼ºåŠ›æå– JSON æ•°ç»„
            const match = text.match(/\[\s*\{[\s\S]*\}\s*\]/);
            if (match) {
                localStorage.setItem('think_agenda', match[0]);
                alert("âœ… å¿«æ·æŒ‡ä»¤æ•°æ®åŒæ­¥æˆåŠŸï¼");
                // æ¸…é™¤ URL ä¸­çš„å‚æ•°ï¼Œé˜²æ­¢é‡å¤å¼¹çª—
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        } catch (e) {
            console.error("è‡ªåŠ¨åŒæ­¥å¤±è´¥", e);
        }
    }
    render(); // è¿è¡ŒåŸæœ‰çš„æ¸²æŸ“å‡½æ•°
};

// ... åŸæœ‰çš„ render å’Œ saveThought å‡½æ•°ä¿æŒä¸å˜ ...

        function saveThought() {
            const val = document.getElementById('thought-input').value;
            localStorage.setItem('thought_' + todayIdx, val);
            document.getElementById('char-count').innerText = val.length + " chars";
        }
        
async function syncData() {
    const btn = document.getElementById('sync-text');
    try {
        btn.innerText = "å¤„ç†ä¸­...";
        // 1. è·å–å‰ªè´´æ¿åŸå§‹æ–‡æœ¬
        let text = await navigator.clipboard.readText();
        
        // 2. é¢„å¤„ç†ï¼šæ·±åº¦æ¸…æ´—
        // å»æ‰å¯èƒ½çš„ Markdown æ ‡ç­¾å’Œå¤šä½™ç©ºç™½
        text = text.replace(/```json/g, "").replace(/```/g, "").trim();

        let finalJsonText = "";

        // 3. æ™ºèƒ½æå–é€»è¾‘
        // æ–¹æ¡ˆ A: å°è¯•è§£ææ˜¯å¦ä¸º DeepSeek çš„åŸå§‹å®Œæ•´ JSON
        try {
            const fullObj = JSON.parse(text);
            if (fullObj.choices && fullObj.choices[0].message.content) {
                finalJsonText = fullObj.choices[0].message.content;
            } else {
                finalJsonText = text;
            }
        } catch(e) {
            // æ–¹æ¡ˆ B: å¦‚æœä¸æ˜¯æ ‡å‡† JSONï¼Œå°è¯•ç”¨æ­£åˆ™è¡¨è¾¾å¼å¼ºè¡ŒæŠ å‡ºæ•°ç»„å†…å®¹ [...]
            const match = text.match(/\[\s*\{[\s\S]*\}\s*\]/);
            if (match) {
                finalJsonText = match[0];
            } else {
                finalJsonText = text;
            }
        }

        // 4. äºŒæ¬¡æ¸…æ´—å¹¶æœ€ç»ˆè§£æ
        finalJsonText = finalJsonText.replace(/```json/g, "").replace(/```/g, "").trim();
        const agenda = JSON.parse(finalJsonText);

        if (!Array.isArray(agenda)) throw new Error("è§£æç»“æœä¸æ˜¯æœ‰æ•ˆçš„è®®é¢˜æ•°ç»„");

        // 5. å­˜å‚¨å¹¶æˆåŠŸåé¦ˆ
        localStorage.setItem('think_agenda', JSON.stringify(agenda));
        btn.innerText = "âœ… åŒæ­¥æˆåŠŸ";
        setTimeout(() => { btn.innerText = "ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜"; }, 2000);
        render();

    } catch (e) {
        console.error("è§£æè¯¦æƒ…:", e);
        btn.innerText = "âŒ æ ¼å¼é”™è¯¯";
        setTimeout(() => { btn.innerText = "ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜"; }, 2000);
        alert("åŒæ­¥å¤±è´¥ï¼\nè¯·ç¡®ä¿ï¼š\n1. å¿«æ·æŒ‡ä»¤è¿è¡Œå®Œæ¯•å¹¶å·²æ‹·è´å†…å®¹\n2. æ‹·è´å†…å®¹ä¸­åŒ…å«ä»¥ [ å¼€å¤´çš„è®®é¢˜æ•°ç»„");
    }
}
        
        function copyMyThought() {
            const content = document.getElementById('thought-input').value;
            const title = document.getElementById('title').innerText;
            if(!content) return alert("è¿˜æ²¡æœ‰è¾“å…¥æ€è€ƒå†…å®¹å“¦");
            
            const textToCopy = `ã€æ€ç»´æ¼”æ­¦åœºã€‘\nè®®é¢˜ï¼š${title}\næˆ‘çš„æ€è€ƒï¼š\n${content}`;
            navigator.clipboard.writeText(textToCopy);
            alert("âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå»åˆ†äº«å§ï¼");
        }

        function clearAll() {
            if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = render;
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ€ç»´æ¼”æ­¦åœº</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
</head>
<body class="bg-slate-50 p-4 pb-20">
    <header class="mb-6 flex justify-between items-end">
        <h1 class="text-2xl font-black italic">MIND LAB.</h1>
        <div class="text-xs text-slate-400 font-mono" id="cur-date"></div>
    </header>

    <button onclick="syncData()" class="w-full mb-6 bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-100 flex items-center justify-center gap-2 active:scale-95 transition-transform">
        <span>ğŸ”„ ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜</span>
    </button>

    <div id="main-card" class="bg-white rounded-3xl p-6 shadow-sm mb-6 border border-slate-100">
        <div id="tag" class="text-blue-500 text-[10px] font-black tracking-widest mb-1 uppercase">Loading...</div>
        <h2 id="title" class="text-xl font-bold text-slate-800 mb-3">è¯·å…ˆè¿è¡Œå¿«æ·æŒ‡ä»¤å¹¶åŒæ­¥</h2>
        <p id="desc" class="text-slate-500 text-sm leading-relaxed mb-6 italic"></p>
        
        <textarea id="thought-input" oninput="saveMyThought()" class="w-full bg-slate-50 p-4 rounded-2xl text-sm h-48 outline-none focus:ring-1 focus:ring-blue-400 transition-all" placeholder="å¼€å§‹ä½ çš„æ‰¹åˆ¤æ€§æ€è€ƒ..."></textarea>
    </div>

    <div id="expert-card" class="bg-amber-50 rounded-3xl p-6 hidden border border-amber-100">
        <h3 class="text-amber-900 font-bold text-sm mb-2 font-mono">Yesterday's Contrast (ä¸“å®¶å¯¹å†²)</h3>
        <p id="expert-text" class="text-amber-800 text-sm leading-relaxed"></p>
    </div>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸå’Œç´¢å¼• (å‘¨ä¸€ä¸º0, å‘¨æ—¥ä¸º6)
        const todayIdx = (new Date().getDay() + 6) % 7; 
        document.getElementById('cur-date').innerText = new Date().toLocaleDateString();

        function render() {
            const data = JSON.parse(localStorage.getItem('think_agenda') || "[]");
            if(data.length > 0) {
                const item = data[todayIdx] || data[0];
                document.getElementById('tag').innerText = (item.tag || "æ·±åº¦") + " ç»´åº¦";
                document.getElementById('title').innerText = item.title;
                document.getElementById('desc').innerText = item.desc;
                
                // åŠ è½½ä¹‹å‰å­˜è¿‡çš„æ€è€ƒå†…å®¹
                document.getElementById('thought-input').value = localStorage.getItem('my_thought_' + todayIdx) || "";

                // åªæœ‰ä¸æ˜¯å‘¨ä¸€æ—¶ï¼Œæ‰æ˜¾ç¤ºå‰ä¸€å¤©çš„ä¸“å®¶è§‚ç‚¹
                if(todayIdx > 0 && data[todayIdx-1].expert) {
                    document.getElementById('expert-card').classList.remove('hidden');
                    document.getElementById('expert-text').innerText = data[todayIdx-1].expert;
                }
            }
        }

        // è‡ªåŠ¨ä¿å­˜æ€è€ƒå†…å®¹
        function saveMyThought() {
            const content = document.getElementById('thought-input').value;
            localStorage.setItem('my_thought_' + todayIdx, content);
        }

        async function syncData() {
            try {
                // 1. è·å–å‰ªè´´æ¿æ–‡æœ¬
                let text = await navigator.clipboard.readText();
                
                // 2. å®¹é”™å¤„ç†ï¼šå»é™¤ DeepSeek å¯èƒ½è¿”å›çš„ Markdown ä»£ç å—æ ‡ç­¾
                text = text.replace(/```json/g, "").replace(/```/g, "").trim();
                
                const json = JSON.parse(text);
                
                // 3. è§£æ DeepSeek çš„åµŒå¥—å†…å®¹
                let content = json.choices[0].message.content;
                // å†æ¬¡å¤„ç†å†…å®¹ä¸­çš„ Markdown æ ‡ç­¾
                content = content.replace(/```json/g, "").replace(/```/g, "").trim();
                
                const agenda = JSON.parse(content);
                
                // 4. å­˜å‚¨å¹¶åˆ·æ–°
                localStorage.setItem('think_agenda', JSON.stringify(agenda));
                alert("âœ… åŒæ­¥æˆåŠŸï¼");
                render();
            } catch(e) {
                console.error(e);
                alert("âŒ è§£æå¤±è´¥ï¼šè¯·ç¡®ä¿ä½ å¤åˆ¶äº†å®Œæ•´çš„ API è¿”å›å†…å®¹ã€‚");
            }
        }

        // é¡µé¢å¯åŠ¨æ—¶è‡ªåŠ¨æ¸²æŸ“
        window.onload = render;
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ€ç»´æ¼”æ­¦åœº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .card-active { border: 2px solid #2563eb; }
    </style>
</head>
<body class="bg-[#f8fafc] text-[#1e293b] leading-relaxed">
    <nav class="sticky top-0 z-50 glass border-b border-slate-200 px-6 py-4 flex justify-between items-center">
        <h1 class="text-xl font-black italic tracking-tighter text-blue-600">MIND LAB.</h1>
        <div id="cur-date" class="text-[10px] font-mono bg-slate-100 px-2 py-1 rounded text-slate-500 uppercase"></div>
    </nav>

    <main class="max-w-lg mx-auto p-6 space-y-6">
        <section>
            <button onclick="syncData()" class="group relative w-full overflow-hidden bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-xl transition-all active:scale-[0.98]">
                <div class="relative z-10 flex items-center justify-center gap-2">
                    <span id="sync-icon">ğŸ”„</span>
                    <span id="sync-text">ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜</span>
                </div>
                <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 opacity-0 group-active:opacity-100 transition-opacity"></div>
            </button>
            <p class="text-[10px] text-center text-slate-400 mt-3 uppercase tracking-widest font-bold">è¯·ç¡®ä¿å·²è¿è¡Œå¿«æ·æŒ‡ä»¤å¹¶å¤åˆ¶å†…å®¹</p>
        </section>

        <section id="main-card" class="bg-white rounded-[2rem] p-8 shadow-sm border border-slate-200/60 relative overflow-hidden">
            <div id="tag" class="inline-block px-3 py-1 bg-blue-50 text-blue-600 text-[10px] font-black rounded-full mb-4 uppercase tracking-tighter">
                Waiting...
            </div>
            <h2 id="title" class="text-2xl font-black text-slate-800 mb-4 leading-tight">å‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„æ·±åº¦æ€è€ƒäº†å—ï¼Ÿ</h2>
            <p id="desc" class="text-slate-500 text-sm mb-8 leading-relaxed italic border-l-2 border-slate-100 pl-4"></p>
            
            <div class="relative">
                <textarea id="thought-input" oninput="saveThought()" class="w-full bg-slate-50 p-5 rounded-2xl text-base h-44 outline-none focus:ring-2 focus:ring-blue-100 transition-all border border-transparent focus:border-blue-200" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„é€»è¾‘æ‹†è§£ã€åˆ©ç›Šåšå¼ˆåˆ†æ..."></textarea>
                <div class="absolute bottom-4 right-4 text-[10px] text-slate-300 font-mono" id="char-count">0 chars</div>
            </div>
        </section>

        <section id="expert-card" class="hidden transform transition-all duration-700">
            <div class="bg-amber-50 rounded-[2rem] p-8 border border-amber-100/50 relative">
                <div class="absolute -top-3 left-8 px-4 py-1 bg-amber-200 text-amber-900 text-[10px] font-black rounded-full uppercase">
                    æ˜¨æ—¥ä¸“å®¶å¯¹å†²è§†è§’
                </div>
                <p id="expert-text" class="text-amber-900/80 text-[15px] leading-relaxed font-medium"></p>
            </div>
        </section>

        <div class="flex gap-3">
            <button onclick="copyMyThought()" class="flex-1 bg-white border border-slate-200 py-3 rounded-xl text-xs font-bold text-slate-600 active:bg-slate-50">å¤åˆ¶æˆ‘çš„æ€è€ƒ</button>
            <button onclick="clearAll()" class="px-4 py-3 rounded-xl text-xs font-bold text-red-400 active:bg-red-50">é‡ç½®</button>
        </div>
    </main>

    <script>
        const todayIdx = (new Date().getDay() + 6) % 7; 
        document.getElementById('cur-date').innerText = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

        function render() {
            const raw = localStorage.getItem('think_agenda');
            if(!raw) return;
            
            const data = JSON.parse(raw);
            if(data.length > 0) {
                const item = data[todayIdx] || data[0];
                document.getElementById('tag').innerText = (item.tag || "æ·±åº¦") + " ç»´åº¦";
                document.getElementById('title').innerText = item.title;
                document.getElementById('desc').innerText = item.desc;
                
                // åŠ è½½æ€è€ƒè®°å½•
                const saved = localStorage.getItem('thought_' + todayIdx);
                const input = document.getElementById('thought-input');
                input.value = saved || "";
                document.getElementById('char-count').innerText = (saved?.length || 0) + " chars";

                // æ˜¾ç¤ºæ˜¨æ—¥å¯¹å†²
                if(todayIdx > 0 && data[todayIdx-1].expert) {
                    document.getElementById('expert-card').classList.remove('hidden');
                    document.getElementById('expert-text').innerText = data[todayIdx-1].expert;
                }
            }
        }

        function saveThought() {
            const val = document.getElementById('thought-input').value;
            localStorage.setItem('thought_' + todayIdx, val);
            document.getElementById('char-count').innerText = val.length + " chars";
        }
        
async function syncData() {
    const btn = document.getElementById('sync-text');
    try {
        btn.innerText = "å¤„ç†ä¸­...";
        let text = await navigator.clipboard.readText();
        
        // --- æ ¸å¿ƒå¢å¼ºè§£æé€»è¾‘ ---
        let agendaData = null;

        // å°è¯• 1: å¦‚æœæ˜¯ DeepSeek å®Œæ•´çš„åŸå§‹è¿”å›ä½“
        try {
            const fullJson = JSON.parse(text);
            if (fullJson.choices && fullJson.choices[0].message.content) {
                text = fullJson.choices[0].message.content;
            }
        } catch(e) { /* ä¸æ˜¯å®Œæ•´JSONï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ç§ */ }

        // å°è¯• 2: å¼ºåŠ›æ­£åˆ™æå– (å³ä½¿ AI è¾“å‡ºäº† ```json ... ``` æˆ–å…¶ä»–æ–‡å­—)
        const jsonMatch = text.match(/\[\s*\{.*\}\s*\]/s); 
        if (jsonMatch) {
            agendaData = JSON.parse(jsonMatch[0]);
        } else {
            // å°è¯•ç›´æ¥è§£æ
            agendaData = JSON.parse(text.replace(/```json/g, "").replace(/```/g, "").trim());
        }

        if(!Array.isArray(agendaData)) throw new Error("è§£æç»“æœä¸æ˜¯æ•°ç»„");

        // --- å­˜å‚¨ä¸åŒæ­¥ ---
        localStorage.setItem('think_agenda', JSON.stringify(agendaData));
        btn.innerText = "åŒæ­¥æˆåŠŸï¼";
        setTimeout(() => { btn.innerText = "ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜"; }, 2000);
        render();
        
    } catch(e) {
        console.error(e);
        btn.innerText = "æ ¼å¼é”™è¯¯";
        setTimeout(() => { btn.innerText = "ç²˜è´´å¹¶åŒæ­¥ä»Šæ—¥è®®é¢˜"; }, 2000);
        alert("âŒ è§£æå¤±è´¥\nå¯èƒ½åŸå› ï¼š\n1. å¿«æ·æŒ‡ä»¤è¿è¡Œæœªå®Œæˆ\n2. è¯·åœ¨å¿«æ·æŒ‡ä»¤Promptä¸­å¼ºè°ƒï¼š'åªè¾“å‡ºJSONæ•°ç»„ï¼Œä¸è¦ä»»ä½•å¼€å¤´ç»“å°¾'");
    }
}

        function copyMyThought() {
            const content = document.getElementById('thought-input').value;
            const title = document.getElementById('title').innerText;
            if(!content) return alert("è¿˜æ²¡æœ‰è¾“å…¥æ€è€ƒå†…å®¹å“¦");
            
            const textToCopy = `ã€æ€ç»´æ¼”æ­¦åœºã€‘\nè®®é¢˜ï¼š${title}\næˆ‘çš„æ€è€ƒï¼š\n${content}`;
            navigator.clipboard.writeText(textToCopy);
            alert("âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå»åˆ†äº«å§ï¼");
        }

        function clearAll() {
            if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = render;
    </script>
</body>
</html>
